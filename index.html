<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FILMX - Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary: #6d28d9;
            --secondary: #1f2937;
            --background: #111827;
            --text-main: #f9fafb;
            --text-secondary: #9ca3af;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text-main);
        }
        .glass-effect {
            background: rgba(31, 41, 55, 0.5);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--secondary); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #8b5cf6; }
        .aspect-2-3 { aspect-ratio: 2 / 3; }
        .switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary); }
        input:checked + .slider:before { transform: translateX(26px); }
    </style>
</head>
<body class="overscroll-none">

    <div id="app" class="flex flex-col min-h-screen">
        <div id="drawer" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300">
            <div id="drawer-content" class="absolute top-0 left-0 h-full w-64 bg-gray-900 shadow-lg p-4 transform -translate-x-full transition-transform duration-300">
                <div class="flex flex-col items-center mb-6">
                    <img src="https://i.ibb.co/5WvscQzD/Background-Eraser-20251018-145001423.jpg" alt="Profile" class="w-24 h-24 rounded-full border-2 border-purple-500 object-cover">
                    <h2 class="text-2xl font-bold mt-4">FILMX</h2>
                </div>
                <nav class="flex flex-col space-y-2">
                    <a href="#" id="permissions-btn" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors">
                        <i data-lucide="shield-check" class="w-5 h-5 mr-3"></i>
                        <span>Permissions</span>
                    </a>
                    <a href="#" id="banner-btn" class="flex items-center p-3 rounded-lg hover:bg-gray-700 transition-colors">
                        <i data-lucide="image" class="w-5 h-5 mr-3"></i>
                        <span>Banners</span>
                    </a>
                </nav>
            </div>
        </div>

        <header class="sticky top-0 glass-effect z-30">
            <div class="container mx-auto p-4 flex justify-between items-center">
                <button id="drawer-toggle" class="p-2 rounded-full hover:bg-gray-700">
                    <i data-lucide="menu" class="w-6 h-6"></i>
                </button>
                <h1 id="header-title" class="text-xl font-bold">Movies</h1>
                <div class="w-10"></div>
            </div>
        </header>

        <main class="flex-grow container mx-auto p-4 mb-20">
            <div id="content-area" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                </div>
        </main>

        <button id="fab" class="fixed bottom-24 right-6 bg-purple-600 hover:bg-purple-700 text-white p-4 rounded-full shadow-lg z-30">
            <i data-lucide="plus" class="w-6 h-6"></i>
        </button>

        <nav class="fixed bottom-0 left-0 right-0 glass-effect z-30">
            <div class="container mx-auto flex justify-around">
                <button data-section="movies" class="nav-item flex-1 p-3 flex flex-col items-center text-purple-400 border-t-2 border-purple-400">
                    <i data-lucide="film" class="w-6 h-6"></i>
                    <span class="text-xs mt-1">Movies</span>
                </button>
                <button data-section="series" class="nav-item flex-1 p-3 flex flex-col items-center text-gray-400">
                    <i data-lucide="tv" class="w-6 h-6"></i>
                    <span class="text-xs mt-1">Series</span>
                </button>
                <button data-section="livetv" class="nav-item flex-1 p-3 flex flex-col items-center text-gray-400">
                    <i data-lucide="satellite-dish" class="w-6 h-6"></i>
                    <span class="text-xs mt-1">Live TV</span>
                </button>
            </div>
        </nav>
    </div>

    <div id="modal-container" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div id="form-modal" class="glass-effect rounded-lg p-6 w-11/12 max-w-md modal-content hidden">
            <h2 id="modal-title" class="text-2xl font-bold mb-4">Add Content</h2>
            <form id="data-form">
                <input type="hidden" id="edit-id">
                <div class="space-y-4">
                    <input type="text" id="name" placeholder="Name" class="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <input type="url" id="image-url" placeholder="Image URL" class="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    
                    <div id="movie-fields" class="hidden space-y-4">
                        <input type="url" id="movie-url" placeholder="Movie URL" class="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <select id="catalogue" class="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option>action/adventure</option>
                            <option>comedy/drama</option>
                            <option>dance/music</option>
                            <option>hollywood adventure</option>
                            <option>hollywood movie</option>
                            <option>horror</option>
                            <option>marathi tadka</option>
                            <option>marvel universe</option>
                            <option>romance/drama</option>
                            <option>sci-fi adventure</option>
                            <option>south movie</option>
                            <option>sport/motivation</option>
                            <option>thriller/crime</option>
                            <option>cartoon movie</option>
                        </select>
                    </div>

                    <div id="series-fields" class="hidden space-y-4">
                        <input type="number" id="series-number" placeholder="Series Number" class="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                        <div id="episodes-container" class="space-y-3">
                            </div>
                        <button type="button" id="add-episode-btn" class="w-full p-2 bg-indigo-600 hover:bg-indigo-700 rounded">Add Episode</button>
                    </div>

                    <div id="livetv-fields" class="hidden space-y-4">
                        <input type="url" id="livetv-url" placeholder="Live TV URL" class="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>

                    <div class="flex items-center justify-between">
                        <span>Public</span>
                        <label class="switch">
                            <input type="checkbox" id="is-public" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="flex justify-end space-x-4 mt-6">
                    <button type="button" id="cancel-btn" class="py-2 px-4 bg-gray-600 hover:bg-gray-700 rounded">Cancel</button>
                    <button type="submit" class="py-2 px-4 bg-purple-600 hover:bg-purple-700 rounded">Save</button>
                </div>
            </form>
        </div>

        <div id="permissions-modal" class="glass-effect rounded-lg p-6 w-11/12 max-w-md modal-content hidden">
             <h2 class="text-2xl font-bold mb-4">Live TV Permissions</h2>
             <div id="permissions-list" class="space-y-3">
                </div>
             <div class="flex justify-end mt-6">
                <button type="button" id="close-permissions-btn" class="py-2 px-4 bg-gray-600 hover:bg-gray-700 rounded">Close</button>
            </div>
        </div>
        
        <div id="banner-modal" class="glass-effect rounded-lg p-6 w-11/12 max-w-md modal-content hidden">
            <h2 class="text-2xl font-bold mb-4">Manage Banners</h2>
            <form id="banner-form" class="flex items-center space-x-2 mb-4">
                <input type="url" id="banner-url" placeholder="Banner URL" class="flex-grow p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-purple-500">
                <input type="hidden" id="banner-edit-id">
                <button type="submit" class="p-2 bg-purple-600 hover:bg-purple-700 rounded"><i data-lucide="plus" class="w-5 h-5"></i></button>
            </form>
            <div id="banner-list" class="space-y-2">
                </div>
             <div class="flex justify-end mt-6">
                <button type="button" id="close-banner-btn" class="py-2 px-4 bg-gray-600 hover:bg-gray-700 rounded">Close</button>
            </div>
        </div>

    </div>
    
    <div id="confirm-dialog" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="glass-effect rounded-lg p-6 w-11/12 max-w-sm">
            <h3 id="confirm-title" class="text-lg font-bold mb-4">Confirm Action</h3>
            <p id="confirm-message">Are you sure you want to continue?</p>
            <div class="flex justify-end space-x-4 mt-6">
                <button id="confirm-cancel" class="py-2 px-4 bg-gray-600 hover:bg-gray-700 rounded">Cancel</button>
                <button id="confirm-ok" class="py-2 px-4 bg-red-600 hover:bg-red-700 rounded">Confirm</button>
            </div>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, onSnapshot, doc, setDoc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // IMPORTANT: Replace with your actual Firebase configuration
        const firebaseConfig = {
  apiKey: "AIzaSyBkbwVouHC1mv6zYDxcBW4Ca_OSQjhYUQQ",
  authDomain: "filmx-96b0f.firebaseapp.com",
  databaseURL: "https://filmx-96b0f-default-rtdb.firebaseio.com",
  projectId: "filmx-96b0f",
  storageBucket: "filmx-96b0f.firebasestorage.app",
  messagingSenderId: "13985169839",
  appId: "1:13985169839:web:ac221c92e01238e610ef5a",
  measurementId: "G-QXVDPCSNRF"
};

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentSection = 'movies';
        let episodeCounter = 0;
        let unsubscribeMovies, unsubscribeSeries, unsubscribeLiveTV, unsubscribeBanners, unsubscribeLiveTVPermissions;

        const ui = {
            contentArea: document.getElementById('content-area'),
            fab: document.getElementById('fab'),
            modalContainer: document.getElementById('modal-container'),
            formModal: document.getElementById('form-modal'),
            modalTitle: document.getElementById('modal-title'),
            dataForm: document.getElementById('data-form'),
            editId: document.getElementById('edit-id'),
            nameInput: document.getElementById('name'),
            imageUrlInput: document.getElementById('image-url'),
            isPublicInput: document.getElementById('is-public'),
            movieFields: document.getElementById('movie-fields'),
            movieUrlInput: document.getElementById('movie-url'),
            catalogueInput: document.getElementById('catalogue'),
            seriesFields: document.getElementById('series-fields'),
            seriesNumberInput: document.getElementById('series-number'),
            episodesContainer: document.getElementById('episodes-container'),
            addEpisodeBtn: document.getElementById('add-episode-btn'),
            livetvFields: document.getElementById('livetv-fields'),
            livetvUrlInput: document.getElementById('livetv-url'),
            cancelBtn: document.getElementById('cancel-btn'),
            navItems: document.querySelectorAll('.nav-item'),
            headerTitle: document.getElementById('header-title'),
            drawer: document.getElementById('drawer'),
            drawerContent: document.getElementById('drawer-content'),
            drawerToggle: document.getElementById('drawer-toggle'),
            permissionsBtn: document.getElementById('permissions-btn'),
            permissionsModal: document.getElementById('permissions-modal'),
            permissionsList: document.getElementById('permissions-list'),
            closePermissionsBtn: document.getElementById('close-permissions-btn'),
            bannerBtn: document.getElementById('banner-btn'),
            bannerModal: document.getElementById('banner-modal'),
            bannerForm: document.getElementById('banner-form'),
            bannerUrlInput: document.getElementById('banner-url'),
            bannerEditId: document.getElementById('banner-edit-id'),
            bannerList: document.getElementById('banner-list'),
            closeBannerBtn: document.getElementById('close-banner-btn'),
            confirmDialog: document.getElementById('confirm-dialog'),
            confirmTitle: document.getElementById('confirm-title'),
            confirmMessage: document.getElementById('confirm-message'),
            confirmOk: document.getElementById('confirm-ok'),
            confirmCancel: document.getElementById('confirm-cancel'),
        };

        const showConfirmation = (title, message) => {
            ui.confirmTitle.textContent = title;
            ui.confirmMessage.textContent = message;
            ui.confirmDialog.classList.remove('hidden');
            return new Promise((resolve) => {
                ui.confirmOk.onclick = () => {
                    ui.confirmDialog.classList.add('hidden');
                    resolve(true);
                };
                ui.confirmCancel.onclick = () => {
                    ui.confirmDialog.classList.add('hidden');
                    resolve(false);
                };
            });
        };

        function addEpisodeInput(episode = { url: '', imageUrl: '' }) {
            episodeCounter++;
            const episodeDiv = document.createElement('div');
            episodeDiv.className = 'p-3 border border-gray-600 rounded relative';
            episodeDiv.innerHTML = `
                <h4 class="font-bold mb-2">Episode ${episodeCounter}</h4>
                <input type="url" placeholder="Episode URL" value="${episode.url}" class="w-full p-2 bg-gray-800 rounded border border-gray-700 mb-2 episode-url" required>
                <input type="url" placeholder="Episode Image URL" value="${episode.imageUrl}" class="w-full p-2 bg-gray-800 rounded border border-gray-700 episode-image-url" required>
                <button type="button" class="absolute top-2 right-2 text-red-500 hover:text-red-400 remove-episode-btn">&times;</button>
            `;
            ui.episodesContainer.appendChild(episodeDiv);
            episodeDiv.querySelector('.remove-episode-btn').addEventListener('click', () => {
                episodeDiv.remove();
            });
        }

        function resetForm() {
            ui.dataForm.reset();
            ui.editId.value = '';
            ui.episodesContainer.innerHTML = '';
            episodeCounter = 0;
            ui.movieFields.classList.add('hidden');
            ui.seriesFields.classList.add('hidden');
            ui.livetvFields.classList.add('hidden');
        }

        function showModal(type, data = null) {
            resetForm();
            if (type === 'movies') {
                ui.modalTitle.textContent = data ? 'Edit Movie' : 'Add Movie';
                ui.movieFields.classList.remove('hidden');
                if (data) {
                    ui.editId.value = data.id;
                    ui.nameInput.value = data.name;
                    ui.imageUrlInput.value = data.imageUrl;
                    ui.movieUrlInput.value = data.movieUrl;
                    ui.catalogueInput.value = data.catalogue;
                    ui.isPublicInput.checked = data.isPublic;
                }
            } else if (type === 'series') {
                ui.modalTitle.textContent = data ? 'Edit Series' : 'Add Series';
                ui.seriesFields.classList.remove('hidden');
                addEpisodeInput();
                if (data) {
                    ui.editId.value = data.id;
                    ui.nameInput.value = data.name;
                    ui.imageUrlInput.value = data.imageUrl;
                    ui.seriesNumberInput.value = data.seriesNumber;
                    ui.isPublicInput.checked = data.isPublic;
                    ui.episodesContainer.innerHTML = '';
                    episodeCounter = 0;
                    data.episodes.forEach(ep => addEpisodeInput(ep));
                }
            } else if (type === 'livetv') {
                ui.modalTitle.textContent = data ? 'Edit Live TV Channel' : 'Add Live TV Channel';
                ui.livetvFields.classList.remove('hidden');
                if (data) {
                    ui.editId.value = data.id;
                    ui.nameInput.value = data.name;
                    ui.imageUrlInput.value = data.imageUrl;
                    ui.livetvUrlInput.value = data.liveTvUrl;
                    ui.isPublicInput.checked = data.isPublic;
                }
            }
            ui.modalContainer.classList.remove('hidden');
            ui.formModal.classList.remove('hidden');
        }

        function hideAllModals() {
            ui.modalContainer.classList.add('hidden');
            ui.formModal.classList.add('hidden');
            ui.permissionsModal.classList.add('hidden');
            ui.bannerModal.classList.add('hidden');
        }

        async function saveData(e) {
            e.preventDefault();
            const id = ui.editId.value;
            let data = {
                name: ui.nameInput.value,
                imageUrl: ui.imageUrlInput.value,
                isPublic: ui.isPublicInput.checked,
                createdAt: new Date()
            };

            if (currentSection === 'movies') {
                data.movieUrl = ui.movieUrlInput.value;
                data.catalogue = ui.catalogueInput.value;
            } else if (currentSection === 'series') {
                data.seriesNumber = parseInt(ui.seriesNumberInput.value);
                data.episodes = Array.from(ui.episodesContainer.children).map(div => ({
                    url: div.querySelector('.episode-url').value,
                    imageUrl: div.querySelector('.episode-image-url').value,
                }));
            } else if (currentSection === 'livetv') {
                data.liveTvUrl = ui.livetvUrlInput.value;
            }

            try {
                if (id) {
                    await setDoc(doc(db, currentSection, id), data, { merge: true });
                } else {
                    await addDoc(collection(db, currentSection), data);
                }
                hideAllModals();
            } catch (error) {
                console.error("Error saving document: ", error);
            }
        }
        
        async function deleteData(id) {
            const confirmed = await showConfirmation('Delete Content', 'Are you sure you want to delete this item? This action cannot be undone.');
            if (confirmed) {
                try {
                    await deleteDoc(doc(db, currentSection, id));
                } catch (error) {
                    console.error("Error removing document: ", error);
                }
            }
        }

        function renderContent(data) {
            ui.contentArea.innerHTML = data.map(item => `
                <div class="glass-effect rounded-lg overflow-hidden relative group">
                    <img src="${item.imageUrl}" alt="${item.name}" class="w-full aspect-2-3 object-cover">
                    <div class="absolute inset-0 bg-black bg-opacity-70 flex flex-col justify-end p-2 opacity-0 group-hover:opacity-100 transition-opacity">
                        <h3 class="font-bold text-sm">${item.name}</h3>
                        <div class="flex justify-between items-center mt-2">
                             <button class="edit-btn p-2 bg-blue-600 rounded-full hover:bg-blue-700" data-id="${item.id}"><i data-lucide="pencil" class="w-4 h-4"></i></button>
                             <button class="delete-btn p-2 bg-red-600 rounded-full hover:bg-red-700" data-id="${item.id}"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
            
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const docToEdit = data.find(d => d.id === btn.dataset.id);
                    showModal(currentSection, docToEdit);
                });
            });

            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteData(btn.dataset.id));
            });
        }

        function setupRealtimeListener(section) {
            // Unsubscribe from previous listeners
            if (unsubscribeMovies) unsubscribeMovies();
            if (unsubscribeSeries) unsubscribeSeries();
            if (unsubscribeLiveTV) unsubscribeLiveTV();
            
            const q = collection(db, section);
            const unsubscribe = onSnapshot(q, (querySnapshot) => {
                const data = [];
                querySnapshot.forEach((doc) => {
                    data.push({ id: doc.id, ...doc.data() });
                });
                renderContent(data.sort((a,b) => b.createdAt.toDate() - a.createdAt.toDate()));
            });

            if(section === 'movies') unsubscribeMovies = unsubscribe;
            if(section === 'series') unsubscribeSeries = unsubscribe;
            if(section === 'livetv') unsubscribeLiveTV = unsubscribe;
        }
        
        function switchSection(section) {
            currentSection = section;
            ui.navItems.forEach(item => {
                if (item.dataset.section === section) {
                    item.classList.add('text-purple-400', 'border-purple-400');
                    item.classList.remove('text-gray-400');
                } else {
                    item.classList.remove('text-purple-400', 'border-purple-400');
                    item.classList.add('text-gray-400');
                }
            });
            const titles = {movies: "Movies", series: "Series", livetv: "Live TV"};
            ui.headerTitle.textContent = titles[section];
            setupRealtimeListener(section);
        }

        // Drawer Logic
        function toggleDrawer(open) {
            if(open){
                ui.drawer.classList.remove('hidden');
                setTimeout(() => {
                    ui.drawer.classList.remove('opacity-0');
                    ui.drawerContent.classList.remove('-translate-x-full');
                }, 10);
            } else {
                ui.drawer.classList.add('opacity-0');
                ui.drawerContent.classList.add('-translate-x-full');
                setTimeout(() => ui.drawer.classList.add('hidden'), 300);
            }
        }
        ui.drawerToggle.addEventListener('click', () => toggleDrawer(true));
        ui.drawer.addEventListener('click', (e) => {
            if(e.target === ui.drawer) toggleDrawer(false);
        });

        // Permissions Logic
        async function showPermissionsModal() {
            toggleDrawer(false);
            ui.modalContainer.classList.remove('hidden');
            ui.permissionsModal.classList.remove('hidden');
            
            if (unsubscribeLiveTVPermissions) unsubscribeLiveTVPermissions();
            const q = collection(db, 'livetv');
            unsubscribeLiveTVPermissions = onSnapshot(q, async (querySnapshot) => {
                const channels = [];
                querySnapshot.forEach((doc) => channels.push({ id: doc.id, ...doc.data() }));

                // Get global permissions doc
                const permsDocRef = doc(db, 'permissions', 'liveTvGlobal');
                let globalPerms = { enabled: true };
                // This will create the document if it doesn't exist.
                await setDoc(permsDocRef, globalPerms, { merge: true });

                ui.permissionsList.innerHTML = `
                    <div class="flex items-center justify-between p-2 rounded bg-gray-800">
                        <span>All Channels</span>
                        <label class="switch">
                            <input type="checkbox" id="global-toggle" ${globalPerms.enabled ? 'checked' : ''}>
                            <span class="slider"></span>
                        </label>
                    </div>
                ` + channels.map(channel => `
                    <div class="flex items-center justify-between p-2 rounded">
                        <span>${channel.name}</span>
                        <label class="switch">
                            <input type="checkbox" class="channel-toggle" data-id="${channel.id}" ${channel.isPublic ? 'checked' : ''}>
                            <span class="slider"></span>
                        </label>
                    </div>
                `).join('');
                
                document.getElementById('global-toggle').addEventListener('change', async (e) => {
                     await setDoc(doc(db, 'permissions', 'liveTvGlobal'), { enabled: e.target.checked });
                });

                document.querySelectorAll('.channel-toggle').forEach(toggle => {
                    toggle.addEventListener('change', async (e) => {
                         await updateDoc(doc(db, 'livetv', e.target.dataset.id), { isPublic: e.target.checked });
                    });
                });
            });
        }
        
        // Banner Logic
        async function showBannerModal() {
            toggleDrawer(false);
            ui.modalContainer.classList.remove('hidden');
            ui.bannerModal.classList.remove('hidden');

            if (unsubscribeBanners) unsubscribeBanners();
            const q = collection(db, 'banners');
            unsubscribeBanners = onSnapshot(q, (querySnapshot) => {
                const banners = [];
                querySnapshot.forEach((doc) => banners.push({ id: doc.id, ...doc.data() }));
                ui.bannerList.innerHTML = banners.map(banner => `
                    <div class="flex items-center justify-between p-2 bg-gray-800 rounded">
                        <span class="truncate text-sm">${banner.url}</span>
                        <div class="flex space-x-2">
                            <button class="edit-banner-btn" data-id="${banner.id}" data-url="${banner.url}"><i data-lucide="pencil" class="w-4 h-4 text-blue-400"></i></button>
                            <button class="delete-banner-btn" data-id="${banner.id}"><i data-lucide="trash-2" class="w-4 h-4 text-red-400"></i></button>
                        </div>
                    </div>
                `).join('');
                lucide.createIcons();
                
                document.querySelectorAll('.edit-banner-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        ui.bannerUrlInput.value = btn.dataset.url;
                        ui.bannerEditId.value = btn.dataset.id;
                        ui.bannerUrlInput.focus();
                    });
                });
                 document.querySelectorAll('.delete-banner-btn').forEach(btn => {
                    btn.addEventListener('click', async () => {
                        const confirmed = await showConfirmation('Delete Banner', 'Are you sure you want to delete this banner?');
                        if (confirmed) {
                           await deleteDoc(doc(db, 'banners', btn.dataset.id));
                        }
                    });
                });
            });
        }

        ui.bannerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const url = ui.bannerUrlInput.value;
            const id = ui.bannerEditId.value;
            if (!url) return;

            try {
                if (id) {
                    await setDoc(doc(db, 'banners', id), { url, updatedAt: new Date() });
                } else {
                    await addDoc(collection(db, 'banners'), { url, createdAt: new Date() });
                }
                ui.bannerForm.reset();
                ui.bannerEditId.value = '';
            } catch(err) { console.error("Error saving banner:", err) }
        });


        // Event Listeners
        ui.fab.addEventListener('click', () => showModal(currentSection));
        ui.cancelBtn.addEventListener('click', hideAllModals);
        ui.dataForm.addEventListener('submit', saveData);
        ui.addEpisodeBtn.addEventListener('click', () => addEpisodeInput());
        ui.navItems.forEach(item => {
            item.addEventListener('click', () => switchSection(item.dataset.section));
        });
        
        ui.permissionsBtn.addEventListener('click', showPermissionsModal);
        ui.closePermissionsBtn.addEventListener('click', hideAllModals);
        
        ui.bannerBtn.addEventListener('click', showBannerModal);
        ui.closeBannerBtn.addEventListener('click', hideAllModals);

        // Initial Load
        lucide.createIcons();
        switchSection('movies');
    </script>
</body>
</html>